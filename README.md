# Pushpin 📋

一个轻量级的 macOS 剪贴板历史管理工具，专为 macOS 14+ (Apple Silicon) 设计。

> 🤖 **本项目完全由 [Antigravity](https://deepmind.google/technologies/gemini/antigravity/) AI 编程助手实现**  
> Antigravity 是 Google DeepMind 开发的强大 AI 编程工具，能够理解需求、设计架构并编写高质量代码。

## ✨ 特性

- 🚀 **快速访问** - 通过全局快捷键或状态栏图标快速唤起
- 📍 **智能定位** - 窗口自动出现在鼠标附近，并智能避开屏幕边缘
- 🎯 **一键粘贴** - 单击历史记录即可粘贴到当前应用
- 💾 **持久化存储** - 历史记录自动保存，重启后依然可用
- 🔧 **自定义快捷键** - 在设置中配置你喜欢的全局快捷键
- 📌 **窗口固定** - 可以固定窗口防止自动隐藏
- 🌓 **后台运行** - 关闭窗口后继续在后台运行，通过状态栏图标控制

## 📦 安装

### 从源码构建

```bash
cd pushpin
swift build -c release
```

### 运行

```bash
swift run
```

## 🎮 使用方法

### 基本操作

1. **启动应用**
   - 运行后，应用会在状态栏显示剪贴板图标
   - 应用不会出现在 Dock 中，完全在后台运行

2. **打开历史面板**
   - 按快捷键（默认：`⌘ Cmd + ⇧ Shift + V`）
   - 或点击状态栏图标
   - 面板会智能地出现在鼠标附近

3. **粘贴历史记录**
   - 单击任意历史记录
   - 内容会自动粘贴到之前活动的应用中

4. **固定窗口**
   - 点击工具栏的 📌 图标
   - 窗口将不会在失去焦点时自动隐藏

5. **自定义快捷键**
   - 点击工具栏的 ⚙️ 图标打开设置
   - 点击快捷键录制按钮
   - 按下你想要的快捷键组合

### 快捷键

- `⌘ Cmd + ⇧ Shift + V` - 切换历史面板显示/隐藏（默认，可自定义）
- `⌘ Cmd + Q` - 退出应用

## ⚙️ 系统要求

- macOS 14.0 或更高版本
- Apple Silicon (M1/M2/M3) 或 Intel 处理器
- Swift 5.9+

## 🔒 权限要求

Pushpin 需要以下系统权限才能正常工作：

- **辅助功能权限** - 用于模拟键盘输入（粘贴功能）
  - 系统偏好设置 → 隐私与安全性 → 辅助功能
  - 添加 Terminal（如果通过 `swift run` 运行）或 Pushpin 应用

## 🏗️ 项目结构

```
pushpin/
├── Sources/
│   └── Pushpin/
│       ├── App.swift              # 应用入口和状态栏管理
│       ├── ContentView.swift      # 主界面
│       ├── ClipboardManager.swift # 剪贴板监控和历史管理
│       ├── HotkeyManager.swift    # 全局快捷键管理
│       ├── PasteManager.swift     # 粘贴功能实现
│       └── SettingsView.swift     # 设置界面
├── Package.swift                  # Swift Package 配置
└── README.md                      # 项目说明
```

## 🛠️ 技术栈

- **SwiftUI** - 现代化的用户界面
- **AppKit** - 窗口管理和系统集成
- **Carbon** - 全局快捷键注册
- **NSPasteboard** - 剪贴板监控
- **CGEvent** - 键盘事件模拟

## 📝 功能详解

### 剪贴板监控

- 使用定时器（0.5秒间隔）轮询 `NSPasteboard.general.changeCount`
- 自动去重：相同内容不会重复添加到历史顶部
- 历史记录限制：最多保存 50 条记录

### 智能窗口定位

- 获取鼠标当前位置
- 检测鼠标所在的显示器
- 根据屏幕边缘智能调整窗口位置：
  - 右边缘：窗口显示在鼠标左侧
  - 左边缘：窗口对齐到屏幕左边缘
  - 下边缘：窗口显示在鼠标上方
  - 上边缘：窗口对齐到屏幕上边缘

### 持久化存储

- 使用 `UserDefaults` 存储历史记录
- 使用 `Codable` 协议序列化数据
- 快捷键配置也会持久化保存

## 🐛 已知问题

- 某些应用可能不支持通过模拟键盘粘贴（安全限制）
- 首次使用需要授予辅助功能权限

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

## 🙏 致谢

感谢所有为这个项目做出贡献的开发者！
